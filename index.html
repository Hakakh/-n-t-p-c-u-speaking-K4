<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G·∫•u Nh·ªè H·ªçc N√≥i - 100+ M·∫´u C√¢u Ti·∫øng Anh</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fade-in 0.4s ease-out forwards; }
        @keyframes blink { 0%, 90%, 100% { transform: scaleY(1); } 95% { transform: scaleY(0.1); } }
        .animate-blink { animation: blink 4s infinite; transform-origin: 70px 80px; }
        .animate-blink-right { animation: blink 4s infinite; transform-origin: 130px 80px; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
        .animate-float { animation: float 3s ease-in-out infinite; }
        @keyframes mouthTalkWide { 0% { transform: scale(1, 0.2); } 50% { transform: scale(1.5, 2.5); } 100% { transform: scale(1, 0.2); } }
        .mouth-talking { animation: mouthTalkWide 0.25s infinite; transform-origin: 100px 135px; }
        .active-scale:active { transform: scale(0.95); }
        .btn-pulse { position: relative; z-index: 1; }
        .btn-pulse::before { content: ''; position: absolute; inset: -4px; background: rgba(99, 102, 241, 0.4); border-radius: 9999px; animation: pulse 1.5s cubic-bezier(0,0,0.2,1) infinite; z-index: -1; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(1.6); opacity: 0; } }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="bg-indigo-50/50 font-sans text-slate-800">
    <div id="root"></div>

    <script type="module">
        import { h, render } from 'https://esm.sh/preact';
        import { useState, useEffect, useCallback, useMemo } from 'https://esm.sh/preact/hooks';
        import htm from 'https://esm.sh/htm';

        const html = htm.bind(h);

        const RAW_DATA = {
            "1. Ch√†o H·ªèi": [
                { en: "Hello! / Hi!", vi: "Xin ch√†o!", emoji: "üëã" },
                { en: "Good morning!", vi: "Ch√†o bu·ªïi s√°ng!", emoji: "‚òÄÔ∏è" },
                { en: "Good afternoon!", vi: "Ch√†o bu·ªïi chi·ªÅu!", emoji: "üå§Ô∏è" },
                { en: "Good evening!", vi: "Ch√†o bu·ªïi t·ªëi!", emoji: "üåô" },
                { en: "Goodbye!", vi: "T·∫°m bi·ªát!", emoji: "üèÉ" },
                { en: "It‚Äôs nice to see you.", vi: "R·∫•t vui ƒë∆∞·ª£c g·∫∑p con.", emoji: "üòä" },
                { en: "Nice to meet you again.", vi: "R·∫•t vui ƒë∆∞·ª£c g·∫∑p l·∫°i con.", emoji: "ü§ù" }
            ],
            "2. C·∫£m ∆†n & Xin L·ªói": [
                { en: "I‚Äôm sorry!", vi: "M·∫π/con xin l·ªói!", emoji: "üôè" },
                { en: "Sorry, I didn‚Äôt mean to do that!", vi: "Xin l·ªói, m·∫π/con kh√¥ng c·ªë √Ω l√†m th·∫ø.", emoji: "ü•∫" },
                { en: "Thank you!", vi: "C·∫£m ∆°n con/m·∫π!", emoji: "‚ù§Ô∏è" },
                { en: "Thank you so much!", vi: "C·∫£m ∆°n m·∫π/con r·∫•t nhi·ªÅu!", emoji: "üíñ" },
                { en: "Thank you very much!", vi: "C·∫£m ∆°n m·∫π/con r·∫•t nhi·ªÅu!", emoji: "üåü" }
            ],
            "3. ThƒÉm H·ªèi Th√¥ng D·ª•ng": [
                { en: "What‚Äôs your name?", vi: "T√™n b·∫°n/con l√† g√¨?", emoji: "üìõ" },
                { en: "What‚Äôs his name?", vi: "T√™n c·ªßa b·∫°n nam ·∫•y l√† g√¨?", emoji: "üë¶" },
                { en: "What‚Äôs her name?", vi: "T√™n c·ªßa b·∫°n n·ªØ ·∫•y l√† g√¨?", emoji: "üëß" },
                { en: "How old are you?", vi: "B·∫°n/con bao nhi√™u tu·ªïi?", emoji: "üéÇ" },
                { en: "How old is he?", vi: "C·∫≠u ·∫•y bao nhi√™u tu·ªïi?", emoji: "üî¢" },
                { en: "How old is she?", vi: "C√¥ ·∫•y bao nhi√™u tu·ªïi?", emoji: "üëß" },
                { en: "How are you?", vi: "B·∫°n/con c√≥ kh·ªèe kh√¥ng?", emoji: "‚ùì" },
                { en: "How was your day?", vi: "Ng√†y h√¥m nay c·ªßa b·∫°n/con th·∫ø n√†o?", emoji: "üåÜ" },
                { en: "Are you hungry?", vi: "B·∫°n/con c√≥ ƒë√≥i kh√¥ng?", emoji: "üòã" },
                { en: "Are you tired?", vi: "B·∫°n/con c√≥ m·ªát kh√¥ng?", emoji: "üò¥" },
                { en: "Are you happy?", vi: "B·∫°n/con c√≥ vui kh√¥ng?", emoji: "üòÑ" },
                { en: "Are you sad?", vi: "B·∫°n/con c√≥ bu·ªìn kh√¥ng?", emoji: "üò¢" },
                { en: "Are you scared?", vi: "B·∫°n/con c√≥ s·ª£ kh√¥ng?", emoji: "üò®" },
                { en: "Are you OK?", vi: "B·∫°n/con c√≥ ·ªïn kh√¥ng?", emoji: "üëå" },
                { en: "Are you thirsty?", vi: "B·∫°n/con c√≥ kh√°t n∆∞·ªõc kh√¥ng?", emoji: "ü•§" }
            ],
            "4. S·ªü Th√≠ch & C√¢u Tr·∫£ L·ªùi": [
                { en: "What present do you want for your birthday?", vi: "Con mu·ªën qu√† g√¨ v√†o sinh nh·∫≠t?", emoji: "üéÅ" },
                { en: "I want a toy / I want a doll.", vi: "Con mu·ªën ƒë·ªì ch∆°i / b√∫p b√™. (G·ª£i √Ω)", emoji: "üß∏" },
                { en: "I want a car / I want a robot.", vi: "Con mu·ªën √¥ t√¥ / robot. (G·ª£i √Ω)", emoji: "ü§ñ" },
                { en: "Would you like to play any sports?", vi: "Con mu·ªën ch∆°i th·ªÉ thao kh√¥ng?", emoji: "‚öΩ" },
                { en: "Yes, I like football / basketball.", vi: "V√¢ng, con th√≠ch b√≥ng ƒë√° / b√≥ng r·ªï. (G·ª£i √Ω)", emoji: "üèÄ" },
                { en: "What is your favorite holiday?", vi: "K·ª≥ ngh·ªâ y√™u th√≠ch c·ªßa con l√† khi n√†o?", emoji: "üèñÔ∏è" },
                { en: "I like summer / Tet holiday.", vi: "Con th√≠ch m√πa h√® / T·∫øt. (G·ª£i √Ω)", emoji: "üßß" },
                { en: "Who is the best superhero?", vi: "Ai l√† anh h√πng tuy·ªát nh·∫•t?", emoji: "ü¶∏" },
                { en: "Spider-Man / Batman is the best.", vi: "Ng∆∞·ªùi Nh·ªán / Ng∆∞·ªùi D∆°i l√† nh·∫•t. (G·ª£i √Ω)", emoji: "üï∏Ô∏è" },
                { en: "What are your favorite colors?", vi: "Con th√≠ch nh·ªØng m√†u s·∫Øc n√†o?", emoji: "üé®" },
                { en: "I like red and blue.", vi: "Con th√≠ch m√†u ƒë·ªè v√† xanh. (G·ª£i √Ω)", emoji: "üî¥" },
                { en: "Which animal do you like best?", vi: "Con th√≠ch con v·∫≠t n√†o nh·∫•t?", emoji: "ü¶Å" },
                { en: "I like dogs and rabbits.", vi: "Con th√≠ch ch√≥ v√† th·ªè. (G·ª£i √Ω)", emoji: "üê∞" },
                { en: "What do you like to eat?", vi: "Con th√≠ch ƒÉn m√≥n g√¨?", emoji: "üçú" },
                { en: "I like chicken and noodles.", vi: "Con th√≠ch th·ªãt g√† v√† m√¨. (G·ª£i √Ω)", emoji: "üçó" },
                { en: "Do you like eating ice cream?", vi: "Con c√≥ th√≠ch ƒÉn kem kh√¥ng?", emoji: "üç¶" },
                { en: "Yes, it is delicious!", vi: "V√¢ng, n√≥ ngon l·∫Øm! (G·ª£i √Ω)", emoji: "üòã" }
            ],
            "5. C∆° Th·ªÉ": [
                { en: "Is this a nose?", vi: "ƒê√¢y l√† m≈©i ph·∫£i kh√¥ng?", emoji: "üëÉ" },
                { en: "Is this a mouth?", vi: "ƒê√¢y l√† mi·ªáng ph·∫£i kh√¥ng?", emoji: "üëÑ" },
                { en: "Where is your face?", vi: "M·∫∑t c·ªßa con ƒë√¢u?", emoji: "üòä" },
                { en: "Where are your eyes?", vi: "M·∫Øt c·ªßa con ƒë√¢u?", emoji: "üëÄ" },
                { en: "Where are your ears?", vi: "Tai c·ªßa con ƒë√¢u?", emoji: "üëÇ" },
                { en: "Is this your head?", vi: "ƒê√¢y l√† ƒë·∫ßu ph·∫£i kh√¥ng?", emoji: "üë∂" }
            ],
            "6. Y√™u C·∫ßu & Ch·ªâ D·∫´n": [
                { en: "Be careful!", vi: "H√£y c·∫©n th·∫≠n!", emoji: "‚ö†Ô∏è" },
                { en: "Slow down!", vi: "H√£y ch·∫≠m l·∫°i!", emoji: "üê¢" },
                { en: "Eat slowly!", vi: "ƒÇn ch·∫≠m th√¥i con!", emoji: "üçΩÔ∏è" },
                { en: "Time to get up!", vi: "ƒê·∫øn gi·ªù d·∫≠y r·ªìi!", emoji: "‚è∞" },
                { en: "Don‚Äôt touch it!", vi: "ƒê·ª´ng ƒë·ªông v√†o ƒë√≥!", emoji: "üö´" },
                { en: "Keep quiet please!", vi: "H√£y gi·ªØ y√™n l·∫∑ng n√†o!", emoji: "ü§´" },
                { en: "Wait a minute.", vi: "Ch·ªù m·ªôt ch√∫t.", emoji: "‚è≥" },
                { en: "Go get your shoes!", vi: "Con ƒëi l·∫•y gi√†y ƒëi!", emoji: "üëü" }
            ],
            "7. ƒê·ªÅ Ngh·ªã": [
                { en: "Let‚Äôs go to the kitchen!", vi: "M√¨nh v√†o b·∫øp ƒëi con!", emoji: "üç≥" },
                { en: "Let‚Äôs play together!", vi: "H√£y c√πng ch∆°i n√†o!", emoji: "üé†" },
                { en: "Let mommy help you!", vi: "ƒê·ªÉ m·∫π gi√∫p con nh√©!", emoji: "ü§±" },
                { en: "Can I play with you?", vi: "M·∫π ch∆°i v·ªõi con nh√©?", emoji: "üé≤" }
            ],
            "8. ƒê·ªông Vi√™n": [
                { en: "Don‚Äôt worry! Mommy is here!", vi: "ƒê·ª´ng lo. M·∫π ·ªü ƒë√¢y!", emoji: "üõ°Ô∏è" },
                { en: "You can do it!", vi: "Con c√≥ th·ªÉ l√†m ƒë∆∞·ª£c!", emoji: "üí™" },
                { en: "Good job!", vi: "Con l√†m t·ªët l·∫Øm!", emoji: "üåü" },
                { en: "I‚Äôm so proud of you!", vi: "M·∫π r·∫•t t·ª± h√†o v·ªÅ con!", emoji: "üíñ" }
            ],
            "9. Luy·ªán T·∫≠p H·ªèi ƒê√°p (K4)": [
                { en: "Where are you from?", vi: "B·∫°n t·ª´ ƒë√¢u ƒë·∫øn?", emoji: "üåç" },
                { en: "I‚Äôm from Vietnam.", vi: "‚Üí M√¨nh ƒë·∫øn t·ª´ Vi·ªát Nam.", emoji: "üáªüá≥" },
                { en: "How many playgrounds are there at your school?", vi: "Tr∆∞·ªùng b·∫°n c√≥ bao nhi√™u s√¢n ch∆°i?", emoji: "üè´" },
                { en: "There is one playground at my school.", vi: "‚Üí Tr∆∞·ªùng m√¨nh c√≥ m·ªôt s√¢n ch∆°i.", emoji: "üèÉ" },
                { en: "How many buildings are there at your school?", vi: "Tr∆∞·ªùng b·∫°n c√≥ bao nhi√™u t√≤a nh√†?", emoji: "üè¢" },
                { en: "There are three buildings at my school.", vi: "‚Üí Tr∆∞·ªùng m√¨nh c√≥ ba t√≤a nh√†.", emoji: "üß±" },
                { en: "What day is it today?", vi: "H√¥m nay l√† th·ª© m·∫•y?", emoji: "üìÖ" },
                { en: "It‚Äôs Monday.", vi: "‚Üí H√¥m nay l√† th·ª© Hai.", emoji: "üóìÔ∏è" },
                { en: "What do you do on Mondays?", vi: "B·∫°n l√†m g√¨ v√†o c√°c ng√†y th·ª© Hai?", emoji: "üéí" },
                { en: "I have English on Mondays.", vi: "‚Üí M√¨nh c√≥ m√¥n Ti·∫øng Anh v√†o th·ª© Hai.", emoji: "üî§" },
                { en: "What do you do on Tuesdays?", vi: "B·∫°n l√†m g√¨ v√†o c√°c ng√†y th·ª© Ba?", emoji: "üìê" },
                { en: "I study Maths on Tuesdays.", vi: "‚Üí M√¨nh h·ªçc m√¥n To√°n v√†o th·ª© Ba.", emoji: "üî¢" },
                { en: "Can you swim?", vi: "B·∫°n c√≥ bi·∫øt b∆°i kh√¥ng?", emoji: "üèä" },
                { en: "Yes, I can.", vi: "‚Üí V√¢ng, m√¨nh bi·∫øt b∆°i.", emoji: "üåä" },
                { en: "Can you play football?", vi: "B·∫°n c√≥ bi·∫øt ƒë√° b√≥ng kh√¥ng?", emoji: "‚öΩ" },
                { en: "Yes, I can play football.", vi: "‚Üí V√¢ng, m√¨nh c√≥ th·ªÉ ƒë√° b√≥ng.", emoji: "ü•Ö" },
                { en: "Can you ride a bike?", vi: "B·∫°n c√≥ bi·∫øt ƒëi xe ƒë·∫°p kh√¥ng?", emoji: "üö≤" },
                { en: "No, I can‚Äôt.", vi: "‚Üí Kh√¥ng, m√¨nh kh√¥ng bi·∫øt.", emoji: "üö´" },
                { en: "Where‚Äôs your school?", vi: "Tr∆∞·ªùng c·ªßa b·∫°n ·ªü ƒë√¢u?", emoji: "üìç" },
                { en: "It‚Äôs in An Kh√™ Ward.", vi: "‚Üí Tr∆∞·ªùng ·ªü ph∆∞·ªùng An Kh√™.", emoji: "üèòÔ∏è" },
                { en: "Why do you like English?", vi: "T·∫°i sao b·∫°n th√≠ch Ti·∫øng Anh?", emoji: "‚ù§Ô∏è" },
                { en: "Because it‚Äôs interesting.", vi: "‚Üí B·ªüi v√¨ n√≥ th√∫ v·ªã.", emoji: "‚ú®" },
                { en: "Why do you like Maths?", vi: "T·∫°i sao b·∫°n th√≠ch m√¥n To√°n?", emoji: "‚ûï" },
                { en: "Because it‚Äôs fun.", vi: "‚Üí B·ªüi v√¨ n√≥ vui.", emoji: "üòÅ" },
                { en: "What subjects do you have today?", vi: "H√¥m nay b·∫°n c√≥ nh·ªØng m√¥n h·ªçc g√¨?", emoji: "üìö" },
                { en: "I have English and Maths.", vi: "‚Üí M√¨nh c√≥ m√¥n Ti·∫øng Anh v√† m√¥n To√°n.", emoji: "üéí" },
                { en: "What‚Äôs your favourite subject?", vi: "M√¥n h·ªçc y√™u th√≠ch c·ªßa b·∫°n l√† g√¨?", emoji: "üåü" },
                { en: "My favourite subject is Science.", vi: "‚Üí M√¥n h·ªçc y√™u th√≠ch c·ªßa m√¨nh l√† Khoa h·ªçc.", emoji: "üß™" },
                { en: "What time do you get up?", vi: "B·∫°n th·ª©c d·∫≠y l√∫c m·∫•y gi·ªù?", emoji: "‚è∞" },
                { en: "I get up at six o‚Äôclock.", vi: "‚Üí M√¨nh th·ª©c d·∫≠y l√∫c 6 gi·ªù ƒë√∫ng.", emoji: "‚òÄÔ∏è" },
                { en: "What time do you have breakfast?", vi: "B·∫°n ƒÉn s√°ng l√∫c m·∫•y gi·ªù?", emoji: "ü•£" },
                { en: "I have breakfast at six thirty.", vi: "‚Üí M√¨nh ƒÉn s√°ng l√∫c 6 gi·ªù 30.", emoji: "üç≥" },
                { en: "When do you have Art?", vi: "Khi n√†o b·∫°n c√≥ m√¥n M·ªπ thu·∫≠t?", emoji: "üé®" },
                { en: "I have it on Monday.", vi: "‚Üí M√¨nh c√≥ m√¥n ƒë√≥ v√†o th·ª© Hai.", emoji: "üñåÔ∏è" },
                { en: "When do you have Science?", vi: "Khi n√†o b·∫°n c√≥ m√¥n Khoa h·ªçc?", emoji: "üî¨" },
                { en: "I have it on Friday.", vi: "‚Üí M√¨nh c√≥ m√¥n ƒë√≥ v√†o th·ª© S√°u.", emoji: "üìÖ" },
                { en: "What do you want to eat?", vi: "B·∫°n mu·ªën ƒÉn g√¨?", emoji: "üçΩÔ∏è" },
                { en: "I want rice.", vi: "‚Üí M√¨nh mu·ªën ƒÉn c∆°m.", emoji: "üçö" },
                { en: "What do you want to drink?", vi: "B·∫°n mu·ªën u·ªëng g√¨?", emoji: "ü•õ" },
                { en: "I want milk.", vi: "‚Üí M√¨nh mu·ªën u·ªëng s·ªØa.", emoji: "üçº" },
                { en: "When‚Äôs your birthday?", vi: "Khi n√†o l√† sinh nh·∫≠t c·ªßa b·∫°n?", emoji: "üéÇ" },
                { en: "It‚Äôs in June.", vi: "‚Üí V√†o th√°ng S√°u.", emoji: "üéà" },
                { en: "When‚Äôs your sports day?", vi: "Khi n√†o l√† ng√†y h·ªôi th·ªÉ thao c·ªßa b·∫°n?", emoji: "üèÉ" },
                { en: "It‚Äôs in March.", vi: "‚Üí V√†o th√°ng Ba.", emoji: "üèÖ" },
                { en: "Is your sports day in March?", vi: "Ng√†y h·ªôi th·ªÉ thao v√†o th√°ng Ba ph·∫£i kh√¥ng?", emoji: "‚ùì" },
                { en: "Yes, it is.", vi: "‚Üí ƒê√∫ng v·∫≠y.", emoji: "‚úÖ" },
                { en: "Is your sports day in April?", vi: "Ng√†y h·ªôi th·ªÉ thao v√†o th√°ng T∆∞ ph·∫£i kh√¥ng?", emoji: "‚ùì" },
                { en: "No, it isn‚Äôt.", vi: "‚Üí Kh√¥ng, kh√¥ng ph·∫£i.", emoji: "‚ùå" }
            ],
            "10. C·∫£m X√∫c & Th√≥i Quen": [
                { en: "How do you feel about this?", vi: "Con c·∫£m th·∫•y th·∫ø n√†o v·ªÅ ƒëi·ªÅu n√†y?", emoji: "üíì" },
                { en: "What did you learn today?", vi: "H√¥m nay con ƒë√£ h·ªçc ƒë∆∞·ª£c g√¨?", emoji: "üè´" },
                { en: "Wash your hands, please!", vi: "Con h√£y r·ª≠a tay ƒëi nh√©!", emoji: "üßº" },
                { en: "Look at the sky!", vi: "H√£y nh√¨n l√™n b·∫ßu tr·ªùi k√¨a!", emoji: "‚òÅÔ∏è" },
                { en: "You are so brave!", vi: "Con th·∫≠t d≈©ng c·∫£m!", emoji: "ü¶∏" }
            ]
        };

        const TOPICS_DATA = Object.entries(RAW_DATA).map(([title, pairs]) => ({
            title,
            pairs: pairs.map(p => ({ english: p.en, vietnamese: p.vi, emoji: p.emoji }))
        }));

        const AppState = { SELECT_TOPIC: 'SELECT_TOPIC', PLAY_GAME: 'PLAY_GAME' };
        const GameState = { READ: 'READ', TRANSLATE: 'TRANSLATE', REVEAL: 'REVEAL', COMPLETE: 'COMPLETE' };

        const CuteCharacter = ({ isSpeaking }) => html`
            <div class="relative w-28 h-28 md:w-36 md:h-36 mx-auto animate-float">
                <svg viewBox="0 0 200 200" class="w-full h-full">
                    <circle cx="100" cy="100" r="80" fill="#FFB347" />
                    <circle cx="50" cy="40" r="25" fill="#FFB347" />
                    <circle cx="150" cy="40" r="25" fill="#FFB347" />
                    <circle cx="50" cy="40" r="15" fill="#FFCC80" />
                    <circle cx="150" cy="40" r="15" fill="#FFCC80" />
                    <g class="animate-blink">
                        <circle cx="70" cy="80" r="10" fill="black" />
                        <circle cx="75" cy="75" r="3" fill="white" />
                    </g>
                    <g class="animate-blink-right">
                        <circle cx="130" cy="80" r="10" fill="black" />
                        <circle cx="135" cy="75" r="3" fill="white" />
                    </g>
                    <ellipse cx="100" cy="120" rx="30" ry="20" fill="#FFCC80" />
                    <path d="M90 110 Q100 120 110 110" fill="none" stroke="black" stroke-width="3" />
                    <ellipse cx="100" cy="135" rx="18" ry="5" fill="black" class=${isSpeaking ? "mouth-talking" : ""} />
                </svg>
            </div>
        `;

        const App = () => {
            const [appState, setAppState] = useState(AppState.SELECT_TOPIC);
            const [sentences, setSentences] = useState([]);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [gameState, setGameState] = useState(GameState.READ);
            const [isSpeaking, setIsSpeaking] = useState(false);

            const handleSpeak = useCallback((text) => {
                if (!('speechSynthesis' in window)) return;
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = 0.75;
                utterance.onstart = () => setIsSpeaking(true);
                utterance.onend = () => setIsSpeaking(false);
                window.speechSynthesis.speak(utterance);
            }, []);

            useEffect(() => {
                if (appState === AppState.PLAY_GAME && (gameState === GameState.READ || gameState === GameState.REVEAL)) {
                    const timer = setTimeout(() => handleSpeak(sentences[currentIndex].english), 500);
                    return () => clearTimeout(timer);
                }
            }, [currentIndex, gameState, appState, sentences, handleSpeak]);

            const handleTopicSelect = (topic) => {
                setSentences(topic.pairs);
                setCurrentIndex(0);
                setGameState(GameState.READ);
                setAppState(AppState.PLAY_GAME);
            };

            const handleNext = () => {
                if (gameState === GameState.READ) setGameState(GameState.TRANSLATE);
                else if (gameState === GameState.TRANSLATE) setGameState(GameState.REVEAL);
                else if (gameState === GameState.REVEAL) {
                    if (currentIndex < sentences.length - 1) {
                        setCurrentIndex(c => c + 1);
                        setGameState(GameState.READ);
                    } else setGameState(GameState.COMPLETE);
                }
            };

            if (appState === AppState.SELECT_TOPIC) {
                return html`
                    <div class="max-w-4xl mx-auto p-4 md:p-8 animate-fade-in">
                        <header class="text-center mb-8">
                            <h1 class="text-3xl md:text-5xl font-black text-indigo-600 mb-2 drop-shadow-sm">G·∫•u Nh·ªè H·ªçc N√≥i üêª</h1>
                            <p class="text-slate-500 font-medium italic">B√© t·∫≠p ƒë·ªçc 100+ m·∫´u c√¢u giao ti·∫øp ti·∫øng Anh!</p>
                        </header>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 pb-10">
                            ${TOPICS_DATA.map(topic => html`
                                <button key=${topic.title} onClick=${() => handleTopicSelect(topic)} 
                                    class="flex items-center gap-4 bg-white p-5 rounded-2xl shadow-sm hover:shadow-md transition-all active-scale group border-2 border-transparent hover:border-indigo-100 text-left">
                                    <span class="text-4xl group-hover:scale-110 transition-transform">${topic.pairs[0].emoji}</span>
                                    <div class="flex flex-col">
                                        <span class="text-base font-bold text-slate-700 leading-tight">${topic.title}</span>
                                        <span class="text-[10px] text-slate-400 font-black uppercase tracking-widest">${topic.pairs.length} C√¢u</span>
                                    </div>
                                </button>
                            `)}
                        </div>
                    </div>
                `;
            }

            const current = sentences[currentIndex];
            const progress = ((currentIndex + 1) / sentences.length) * 100;

            return html`
                <div class="max-w-lg mx-auto p-4 flex flex-col min-h-screen animate-fade-in">
                    <div class="flex items-center justify-between mb-3">
                        <button onClick=${() => setAppState(AppState.SELECT_TOPIC)} class="text-indigo-600 font-bold p-2 active-scale text-sm">‚Üê Quay l·∫°i</button>
                        <span class="bg-white px-3 py-1 rounded-full text-[11px] font-black shadow-sm text-slate-500">${currentIndex + 1} / ${sentences.length}</span>
                    </div>

                    <div class="h-2 bg-slate-200 rounded-full mb-4 overflow-hidden">
                        <div class="h-full bg-indigo-500 transition-all duration-300" style="width: ${progress}%"></div>
                    </div>

                    <div class="bg-white rounded-[2.5rem] shadow-xl p-8 flex-grow flex flex-col items-center justify-center text-center relative overflow-hidden border-4 border-indigo-50">
                        ${gameState === GameState.COMPLETE ? html`
                            <div class="animate-fade-in">
                                <div class="text-7xl mb-6">üèÜ</div>
                                <h2 class="text-3xl font-black text-indigo-600 mb-2">Con Gi·ªèi Qu√°!</h2>
                                <p class="text-slate-500 mb-8 font-medium">Con ƒë√£ ho√†n th√†nh to√†n b·ªô b√†i h·ªçc n√†y.</p>
                                <button onClick=${() => setAppState(AppState.SELECT_TOPIC)} class="bg-indigo-500 text-white px-10 py-4 rounded-2xl font-black shadow-lg active-scale hover:bg-indigo-600 transition-colors">H·ªçc B√†i M·ªõi Th√¥i!</button>
                            </div>
                        ` : html`
                            <div class="w-full flex flex-col items-center">
                                <${CuteCharacter} isSpeaking=${isSpeaking} />
                                
                                <div class="mt-8 min-h-[160px] flex flex-col items-center justify-center w-full">
                                    ${gameState === GameState.READ || gameState === GameState.REVEAL ? html`
                                        <div class="animate-fade-in w-full">
                                            <p class="text-[10px] font-black uppercase tracking-widest mb-3 ${gameState === GameState.READ ? 'text-indigo-400' : 'text-green-500'}">
                                                ${gameState === GameState.READ ? "Nghe v√† ƒë·ªçc theo G·∫•u nh√©:" : "ƒê√°p √°n ƒë√∫ng n√®:"}
                                            </p>
                                            <h2 class="text-2xl md:text-3xl font-black mb-4 leading-tight text-slate-800 break-words">${current.english}</h2>
                                            <p class="text-lg text-slate-400 font-medium italic mb-6">${current.vietnamese}</p>
                                            
                                            <button onClick=${() => handleSpeak(current.english)} 
                                                class="relative w-16 h-16 rounded-full bg-indigo-500 text-white shadow-lg active-scale flex items-center justify-center transition-all ${isSpeaking ? 'btn-pulse bg-indigo-600' : ''}">
                                                <span class="text-3xl">${isSpeaking ? 'üéôÔ∏è' : 'üîä'}</span>
                                            </button>
                                        </div>
                                    ` : html`
                                        <div class="animate-fade-in w-full px-4">
                                            <p class="text-[10px] font-black text-orange-400 uppercase tracking-widest mb-3">C√¢u n√†y n√≥i ti·∫øng Anh th·∫ø n√†o?</p>
                                            <h2 class="text-2xl font-black text-slate-700 leading-tight">${current.vietnamese}</h2>
                                            <div class="text-6xl mt-8 opacity-30 animate-bounce">‚ùì</div>
                                        </div>
                                    `}
                                </div>
                            </div>
                        `}
                        <div class="absolute top-6 right-6 text-4xl opacity-80">${current?.emoji}</div>
                    </div>

                    ${gameState !== GameState.COMPLETE && html`
                        <div class="mt-6 flex gap-4">
                            <button onClick=${() => currentIndex > 0 ? setCurrentIndex(c => c - 1) : null} 
                                disabled=${currentIndex === 0 && gameState === GameState.READ}
                                class="w-16 bg-white rounded-2xl shadow-sm font-bold text-slate-400 border-2 border-slate-100 disabled:opacity-20 active-scale text-2xl flex items-center justify-center">‚Üê</button>
                            <button onClick=${handleNext} 
                                class="flex-grow bg-indigo-500 text-white rounded-2xl py-5 font-black text-xl shadow-lg border-b-4 border-indigo-700 active-scale active:border-b-0">
                                ${gameState === GameState.READ ? "Th·ª≠ d·ªãch c√¢u n√†y" : gameState === GameState.TRANSLATE ? "Xem ƒë√°p √°n" : "C√¢u ti·∫øp theo ‚Üí"}
                            </button>
                        </div>
                    `}
                </div>
            `;
        };

        render(html`<${App} />`, document.getElementById('root'));
    </script>
</body>
</html>
